<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrollChips Redação</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fontes Inter e Font Awesome para ícones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variáveis CSS do TrollChips */
        :root {
            /* --- Cores principais --- */
            --primary: #1e90ff; /* Azul principal */
            --primary-dark: #1c86ee; /* Azul mais escuro */
            --primary-light: #63b3ff; /* Azul claro */
            --primary-ultra-light: #cce4ff; /* Azul bem clarinho */

            /* --- Cores secundárias e fundo --- */
            --secondary: #0d0d0d;
            --secondary-light: #1a1a1a;
            --background: #001f3f; /* Fundo azul escuro */
            --background-light: #003366; /* Fundo azul um pouco mais claro */

            /* --- Cards e interações --- */
            --card: #00264d; /* Azul escuro para cartões */
            --card-hover: #003366; /* Hover azul */
            
            /* --- Textos --- */
            --text-primary: #f0f0f0; /* Branco para contraste */
            --text-secondary: #b0b0b0;
            --text-muted: #808080;

            /* --- Feedback --- */
            --success: #48bb78; /* Verde */
            --error: #f56565;   /* Vermelho */
            --warning: #ed8936; /* Laranja */
            --info: #63b3ff; /* Azul claro */

            /* --- Bordas e sombras --- */
            --border: #333333;
            --border-light: rgba(255, 255, 255, 0.1);
            --shadow: rgba(0, 0, 0, 0.5);
            --shadow-lg: rgba(0, 0, 0, 0.7);

            /* --- Efeitos de brilho --- */
            --glow: rgba(30, 144, 255, 0.5); /* Azul glow */
            --glow-intense: rgba(30, 144, 255, 1);
            --pulse-glow: rgba(30, 144, 255, 0.8);

            /* --- Efeito glassmorphism --- */
            --glass-bg: rgba(0, 38, 77, 0.05);
            --glass-border: rgba(255, 255, 255, 0.08);

            /* --- Discord-style (opcional) --- */
            --discord-gray: #2C2F33;
            --discord-dark-gray: #23272A;
        }

        /* Imagem de fundo personalizada */
        :root {
            --custom-background-image: url('https://trollchipss.netlify.app/logo-trollchips.png');
            --custom-background-position: center;
            --custom-background-size: cover;
            --custom-background-repeat: no-repeat;
        }

        /* Estilos globais e de barra de rolagem */
        html {
            scroll-behavior: smooth;
            scrollbar-width: none;
            height: 100%;
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        ::-webkit-scrollbar {
            display: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-image: var(--custom-background-image);
            background-position: var(--custom-background-position);
            background-size: var(--custom-background-size);
            background-repeat: var(--custom-background-repeat);
            background-attachment: fixed;
            background-color: transparent;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px 20px;
            position: relative;
            font-weight: 400;
        }

        /* Header Fixo */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: rgba(28, 28, 28, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 0 20px;
            z-index: 1010;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .header-back-button {
            background-color: transparent;
            border: 1px solid var(--primary-light);
            color: var(--primary-light);
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .header-back-button:hover {
            background-color: var(--primary);
            color: white;
        }

        /* Preloader */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--custom-background-image);
            background-position: var(--custom-background-position);
            background-size: var(--custom-background-size);
            background-repeat: var(--custom-background-repeat);
            background-color: var(--background);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.6s ease-out;
        }
        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid transparent;
            border-top: 3px solid var(--primary-light);
            border-right: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            filter: drop-shadow(0 0 20px var(--glow));
        }
        .loader::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 2px solid var(--primary-ultra-light);
            border-radius: 50%;
            animation: spin 1.5s linear infinite reverse;
        }
        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Container de partículas */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .particle {
            position: absolute;
            background-color: var(--primary-light);
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 6px var(--primary-light), 0 0 12px var(--primary-light);
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.4; }
            100% { transform: translateY(105vh) rotate(360deg); opacity: 0; }
        }

        /* Overlay de carregamento */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        #loadingOverlay.visible {
            opacity: 1;
            pointer-events: all;
        }
        #loadingOverlay img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            border-radius: 50%;
        }
        #loadingOverlay .loading-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
        }
        #loadingOverlay .loading-message {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Layout principal */
        .main-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            min-height: 100vh;
            background-color: transparent;
            animation: fadeIn 0.5s ease-out;
            position: relative;
            padding: 20px;
            box-sizing: border-box;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cabeçalho da página de redação */
        .redacao-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
            position: relative;
            width: 100%;
        }
        
        .redacao-title {
            font: 700 48px/1 'Montserrat', sans-serif;
            color: var(--text-primary);
            text-shadow: 0 0 15px var(--glow);
            position: relative;
            display: inline-block;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .redacao-subtitle {
            margin: 20px 0 0;
            color: var(--text-secondary);
            font-weight: 500;
            letter-spacing: 1px;
            font-size: 18px;
        }
        
        .redacao-underline {
            height: 4px;
            width: 120px;
            margin: 20px auto 0;
            border-radius: 999px;
            background: var(--primary);
            filter: blur(1px);
            box-shadow: 0 0 10px var(--glow);
            animation: scaleIn 1s ease-out;
        }

        /* Card principal */
        .redacao-card {
            width: 100%;
            max-width: 560px;
            margin-top: 30px;
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 30px;
            backdrop-filter: blur(12px) saturate(180%);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1s ease-out;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .redacao-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5), 0 0 20px var(--glow);
        }

        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 0 25px 0;
            position: relative;
        }

        .centered-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            box-shadow: 0 0 20px var(--glow);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .centered-image:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--primary-light);
        }

        label {
            display: block;
            font-weight: 600;
            margin: 20px 4px 12px;
            color: var(--text-primary);
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 14px;
        }
        
        .field {
            background: var(--background-light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 18px;
            color: var(--text-primary);
            outline: none;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-family: 'Inter', sans-serif;
        }
        
        .field::placeholder {
            color: var(--text-muted);
        }
        
        .field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--glow);
            background: var(--card);
        }

        .input-row {
            position: relative;
        }
        
        .eye {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: 0;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-muted);
            opacity: .9;
            transition: all 0.2s;
            z-index: 3;
        }

        .eye:hover {
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }

        .config-row {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .config-input {
            flex: 1;
        }

        .config-input label {
            margin-bottom: 8px;
            font-size: 12px;
        }

        .config-input input {
            width: 100%;
            padding: 10px;
            background: var(--background-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
        }

        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 6px 10px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .spinner {
            width: 18px;
            height: 18px;
            border: 3px solid rgba(157, 138, 255, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .btn {
            width: 100%;
            border: 1px solid var(--border);
            background: var(--primary);
            color: var(--text-primary);
            padding: 16px 18px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            z-index: 1;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-family: 'Inter', sans-serif;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5), 0 0 20px var(--glow);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .btn.primary {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .stack {
            display: grid;
            gap: 16px;
            margin-top: 20px;
        }

        footer {
            text-align: center;
            margin-top: 35px;
            color: var(--text-muted);
            font-size: 14px;
            animation: fadeInUp 1s ease-out 0.5s both;
        }
        
        .madeby {
            opacity: .9;
            letter-spacing: 1px;
        }

        /* Animações de entrada */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scaleX(0);
            }
            to {
                opacity: 1;
                transform: scaleX(1);
            }
        }

        /* Estilos para as notificações */
        #notificationsContainer {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .Notificacao {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s, transform 0.3s;
            backdrop-filter: blur(12px) saturate(180%);
            border-left: 4px solid var(--info);
        }

        .Notificacao.show {
            opacity: 1;
            transform: translateX(0);
        }

        .Notificacao.fadeOut {
            opacity: 0;
            transform: translateX(100%);
        }

        .Notificacao p {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .progressbar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--info);
            animation: progressbar linear;
        }

        .Notificacao.success { border-left-color: var(--success); }
        .Notificacao.warning { border-left-color: var(--warning); }
        .Notificacao.error { border-left-color: var(--error); }
        .Notificacao.info { border-left-color: var(--info); }

        .Notificacao.success .progressbar { background: var(--success); }
        .Notificacao.warning .progressbar { background: var(--warning); }
        .Notificacao.error .progressbar { background: var(--error); }
        .Notificacao.info .progressbar { background: var(--info); }

        @keyframes progressbar {
            from { width: 100%; }
            to { width: 0%; }
        }

        /* Estilos para os modais */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(15px) saturate(180%);
            animation: modalSlideIn 0.4s ease;
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            color: var(--primary-light);
            text-shadow: 0 0 10px var(--glow);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(157, 138, 255, 0.2);
            transform: rotate(90deg);
            text-shadow: 0 0 10px var(--primary);
        }

        .task-list-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: var(--background-light);
            border-radius: 12px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .task-list-checkbox:hover {
            background: rgba(157, 138, 255, 0.2);
            border-color: var(--border-light);
            transform: translateX(5px);
            box-shadow: 0 0 10px var(--glow);
        }

        .task-list-checkbox input[type="checkbox"] {
            margin-right: 12px;
            accent-color: var(--primary);
            width: 18px;
            height: 18px;
        }

        .task-list-checkbox label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
            color: var(--text-primary);
        }

        /* Responsividade */
        @media (max-width: 768px) {
            body {
                padding: 70px 10px 10px;
            }
            .main-layout {
                padding: 10px;
            }
            .redacao-title {
                font-size: 36px;
            }
            .config-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <a href="#" class="header-back-button">
           <i class="fas fa-arrow-left"></i>&nbsp;Voltar
        </a>
    </header>

    <!-- Preloader -->
    <div id="preloader">
        <div class="loader"></div>
        <div class="loading-text">Carregando...</div>
    </div>

    <!-- Container de partículas -->
    <div id="particle-container"></div>

    <!-- Overlay de carregamento -->
    <div id="loadingOverlay" class="flex flex-col items-center justify-center">
        <img src="https://trollchipss.netlify.app/logo-trollchips.png" alt="Logo" class="mb-5 rounded-full">
        <p class="loading-title">Carregando...</p>
        <p class="loading-message">Sincronizando dados.</p>
    </div>

    <!-- Modal de seleção de redação -->
    <div id="redacaoSelectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="redacaoSelectionModalTitle" class="modal-title">Selecionar Redação</h3>
                <button id="closeRedacaoSelectionModalBtn" class="close-modal">×</button>
            </div>
            <div id="redacaoListContainer"></div>
            <button id="selectRedacaoBtn" class="btn primary" style="margin-top: 20px;">Selecionar</button>
        </div>
    </div>

    <!-- Modal de progresso -->
    <div id="progressModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Processando</h3>
            </div>
            <p id="progressModalMessage">Aguarde enquanto processamos sua solicitação...</p>
        </div>
    </div>

    <!-- Container para notificações -->
    <div id="notificationsContainer"></div>

    <!-- Layout Principal -->
    <div class="main-layout">
        <div class="redacao-header">
            <h1 class="redacao-title">TrollChips Redação</h1>
            <div class="redacao-underline" aria-hidden="true"></div>
            <p class="redacao-subtitle">Sistema de Redação Automática</p>
        </div>
        
        <main class="redacao-card">
            <div class="image-container">
                <img src="https://trollchipss.netlify.app/logo-trollchips.png" alt="TrollChips" class="centered-image">
            </div>
            
            <div>
                <label for="ra">RA</label>
                <input class="field" id="ra" placeholder="RA + dígito + sp | ex: 000000011xsp" autocomplete="username">
            </div>

            <div class="input-row">
                <label for="senha">Senha</label>
                <input class="field" id="senha" type="password" placeholder="Senha | ex: Aluno_2025" autocomplete="current-password">
                <button class="eye" type="button" id="toggleEye">👁️</button>
            </div>

            <div class="config-row">
                <div class="config-input">
                    <label for="min-time">Tempo mínimo (min)</label>
                    <input type="number" id="min-time" value="5" min="1" max="60">
                </div>
                <div class="config-input">
                    <label for="max-time">Tempo máximo (min)</label>
                    <input type="number" id="max-time" value="15" min="1" max="60">
                </div>
            </div>

            <div class="status">
                <button id="verifyBtn" aria-label="Verificar" style="width: 18px; height: 18px; border: 1px solid var(--text-primary); border-radius: 4px; background: transparent; cursor: pointer;"></button>
                <span class="spinner" id="spinner" style="display: none;"></span> 
                <span id="statusText">Não verificado</span>
            </div>

            <div class="stack">
                <button id="searchRedacaoBtn" class="btn primary" disabled="disabled"><i class="fas fa-search"></i> Buscar Redações</button>
                <button class="btn" disabled="disabled">Redações Expiradas</button>
            </div>
            
            <div id="msgArea" style="margin-top: 10px; color: var(--text-secondary); font-size: 14px;"></div>
        </main>

        <footer>
            <p class="madeby">Criado por <strong>TrollChips</strong></p>
        </footer>
    </div>

    <script>
        // Configuração do sistema de redação
        const config = {
            ENABLE_SUBMISSION: false,
            LOGIN_URL: 'https://sedintegracoes.educacao.sp.gov.br/credenciais/api/LoginCompletoToken',
            API_BASE_URL: 'https://edusp-api.ip.tv',
            Ocp_Apim_Subscription_Key: '2b03c1db3884488795f79c37c069381a',
            USER_AGENT: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36",
            GEMINI_API_KEYS: [
                'AIzaSyBm19Mf_N3Zb-uZOYF3UDvsnrtGVUjaUBk',
                'AIzaSyBPD0aDJArOiG1-qNmM1BUkNIDyqxIb-fw',
                'AIzaSyCiI2FUcOz_055I2ZrQ05IuIoqNmiZGV2Y',
                'AIzaSyBI0tP3ZG_ax2wW1Ivw8zbLWmMzMEDYjJM',
                'AIzaSyD6uxZZbrXSHhrm3Ysg_WvNWMtLGIGfndE',
                'AIzaSyAxSURXv2pKciZSFjxbNrvdYDx1Y6US1CU',
                'AIzaSyD9EoMlVzBY_Y1efyVKyL90QlySshnrnZI'
            ]
        };

        // Variáveis globais
        let trava = false;
        let currentFetchedRedacoes = [];
        let selectedRedacaoId = null;
        let currentAuthToken = null;
        let userNick = null;
        let currentTaskId = null;
        let currentRoomName = null;
        let currentQuestionId = null;
        let currentQuestionType = null;
        let currentRedacaoContent = null;

        // Prompts para geração de redação
        const promptsGeracao = [
            `Crie uma redação escolar completa a partir das informações abaixo. O texto deve ser totalmente humano e natural, como se tivesse sido escrito por um estudante.

Siga estas regras de forma obrigatória:

1. A redação deve ter um título criativo.
2. Escreva o texto completo da redação, em parágrafos corridos.
3. Não use ** ou * em nenhum lugar do título ou do texto.
4. Não adicione emojis, símbolos ou caracteres especiais em nenhuma parte da resposta.
5. Não use símbolos como traços longos ou reticências. Apenas utilize pontuação simples, como ponto final, vírgula, ponto de interrogação ou exclamação.
6. O texto deve ser claro, acessível e coerente, mantendo um tom escolar.
7. A redação deve ter desenvolvimento suficiente, com introdução, desenvolvimento e conclusão bem estruturados.
8. Não escreva listas no texto final, apenas parágrafos narrativos.
9. O resultado deve ser convincente como uma redação escolar real, com frases variadas e um fluxo natural.
10. Respeite rigorosamente a formatação a seguir:

TITULO: [Título da redação]
TEXTO: [Texto da redação]

Aqui estão as informações para a redação:
{dadosRedacao}

Lembre-se: devolva APENAS a redação pronta, sem comentários, explicações ou qualquer informação adicional.`,
        ];

        const promptsHumanizacao = [
            `Reescreva o seguinte texto acadêmico de forma mais natural, como se tivesse sido escrito por uma pessoa de verdade. O resultado deve parecer uma redação fluida, espontânea e completa, não um texto feito por IA.

1. Aqui estão as instruções obrigatórias que você deve seguir:
2. Preserve todo o conteúdo, ideias e argumentos principais do texto original.
3. Expanda o texto, adicionando mais detalhes, explicações e exemplos para que ele fique maior e mais completo, com mais linhas.
4. Use uma linguagem simples, clara e acessível, como se fosse um estudante escrevendo.
5. Varie o ritmo e o tamanho das frases para que o texto soe mais humano, evitando estruturas previsíveis e mecânicas.
6. Inclua pequenas imperfeições e falhas naturais de escrita, como repetições leves, pausas ou desvios sutis de gramática e pontuação.
7. Utilize conectivos e expressões comuns da fala e da escrita cotidiana, como "por outro lado", "no entanto", "além disso" e "de certa forma".
8. Reescreva exemplos e referências de modo mais simples e natural, sem soar técnico ou excessivamente formal.
9. Evite jargões difíceis e termos muito acadêmicos. Prefira explicações fáceis de compreender.
10. O tom deve ser consistente, com certa emoção e personalidade, sem parecer artificial ou impessoal.
11. Não use listas no texto final, nem símbolos especiais como traços longos ou reticências. Escreva em parágrafos corridos e narrativos.
12. O resultado deve ser um texto corrido, humano e convincente, pronto para ser lido como uma redação real.

Texto para reescrever:
{textoRedacao}

Devolva APENAS o texto reescrito, sem comentários, explicações ou marcações adicionais.`,
        ];

        // Função para mostrar notificações
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationsContainer');
            const notification = document.createElement('div');
            notification.className = `Notificacao ${type}`;
            
            notification.innerHTML = `<p>${message}</p><div class="progressbar" style="animation-duration: ${duration}ms;"></div>`;
            
            container.prepend(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
